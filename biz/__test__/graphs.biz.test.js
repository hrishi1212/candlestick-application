const expect = require('expect');
const GraphBiz = require('../graphs.biz');

describe('Graph biz test', () => {
    
    test('calculateData', async ()=> {

        const data = [{"p":7564.04,"q":0.009073,"s":"BTCUSDT","T":1587812241184,"m":true},{"p":7564.04,"q":0.001481,"s":"BTCUSDT","T":1587812241082,"m":true},{"p":7564.04,"q":0.009302,"s":"BTCUSDT","T":1587812240974,"m":true},{"p":7564.04,"q":0.060158,"s":"BTCUSDT","T":1587812240877,"m":true},{"p":7564.04,"q":0.060152,"s":"BTCUSDT","T":1587812240468,"m":true},{"p":7564.05,"q":0.039637,"s":"BTCUSDT","T":1587812240357,"m":false},{"p":7564.05,"q":0.004076,"s":"BTCUSDT","T":1587812240345,"m":false},{"p":7564.04,"q":0.06005,"s":"BTCUSDT","T":1587812240092,"m":true},{"p":7564.04,"q":0.060102,"s":"BTCUSDT","T":1587812239706,"m":true},{"p":7564.04,"q":0.001734,"s":"BTCUSDT","T":1587812239512,"m":true},{"p":7564.04,"q":0.0608,"s":"BTCUSDT","T":1587812239321,"m":true},{"p":7564.04,"q":0.060127,"s":"BTCUSDT","T":1587812238932,"m":true},{"p":7564.05,"q":0.016244,"s":"BTCUSDT","T":1587812238659,"m":false},{"p":7564.04,"q":0.06008,"s":"BTCUSDT","T":1587812238548,"m":true},{"p":7564.04,"q":2.337533,"s":"BTCUSDT","T":1587812238487,"m":true},{"p":7564.04,"q":0.060057,"s":"BTCUSDT","T":1587812238158,"m":true},{"p":7564.05,"q":0.002643,"s":"BTCUSDT","T":1587812237797,"m":false},{"p":7564.04,"q":0.060138,"s":"BTCUSDT","T":1587812237772,"m":true},{"p":7564.04,"q":0.320702,"s":"BTCUSDT","T":1587812237485,"m":true},{"p":7564.04,"q":0.00171,"s":"BTCUSDT","T":1587812237399,"m":true},{"p":7564.04,"q":0.06057,"s":"BTCUSDT","T":1587812237397,"m":true},{"p":7564.04,"q":0.009073,"s":"BTCUSDT","T":1587812237091,"m":true},{"p":7564.04,"q":0.017502,"s":"BTCUSDT","T":1587812237017,"m":true},{"p":7564.05,"q":0.009073,"s":"BTCUSDT","T":1587812236998,"m":true},{"p":7564.05,"q":0.009073,"s":"BTCUSDT","T":1587812236888,"m":true},{"p":7564.12,"q":0.060166,"s":"BTCUSDT","T":1587812236627,"m":true},{"p":7564.28,"q":0.233656,"s":"BTCUSDT","T":1587812236262,"m":false},{"p":7564.12,"q":0.060282,"s":"BTCUSDT","T":1587812236245,"m":true},{"p":7564.09,"q":0.005965,"s":"BTCUSDT","T":1587812236156,"m":true},{"p":7564.16,"q":0.17819,"s":"BTCUSDT","T":1587812236054,"m":false},{"p":7564.19,"q":0.17819,"s":"BTCUSDT","T":1587812235950,"m":false},{"p":7564.05,"q":0.060059,"s":"BTCUSDT","T":1587812235857,"m":true},{"p":7564.23,"q":0.17819,"s":"BTCUSDT","T":1587812235848,"m":false},{"p":7564.06,"q":0.023916,"s":"BTCUSDT","T":1587812235533,"m":false},{"p":7564.05,"q":0.060079,"s":"BTCUSDT","T":1587812235469,"m":true},{"p":7564.05,"q":0.00171,"s":"BTCUSDT","T":1587812235447,"m":true},{"p":7564.06,"q":0.033063,"s":"BTCUSDT","T":1587812235440,"m":false},{"p":7564.06,"q":0.0088,"s":"BTCUSDT","T":1587812235320,"m":false},{"p":7564.06,"q":0.052828,"s":"BTCUSDT","T":1587812235289,"m":false},{"p":7563.91,"q":1.259241,"s":"BTCUSDT","T":1587812235090,"m":true},{"p":7564.14,"q":0.060165,"s":"BTCUSDT","T":1587812235063,"m":true},{"p":7564.29,"q":0.008832,"s":"BTCUSDT","T":1587812234696,"m":false},{"p":7564.06,"q":0.060098,"s":"BTCUSDT","T":1587812234674,"m":true},{"p":7564.29,"q":0.006165,"s":"BTCUSDT","T":1587812234574,"m":false},{"p":7564.58,"q":0.526562,"s":"BTCUSDT","T":1587812234383,"m":false},{"p":7563.89,"q":0.06012,"s":"BTCUSDT","T":1587812234285,"m":true},{"p":7564.48,"q":0.008858,"s":"BTCUSDT","T":1587812234276,"m":false},{"p":7564.37,"q":0.007442,"s":"BTCUSDT","T":1587812234068,"m":false},{"p":7564.66,"q":0.49713,"s":"BTCUSDT","T":1587812233967,"m":false},{"p":7563.85,"q":0.013802,"s":"BTCUSDT","T":1587812233949,"m":true}];

        const graphBiz = new GraphBiz();
        const result = await graphBiz.calculateData(data);
        //to check if return is a array or no
        let containArrays = true;
        if(result.length == 0) {
            containArrays = false
        }

        expect(containArrays).toBeTruthy();
    });

    test('calculateDataTime', async ()=> {

        const data = [{"p":7564.04,"q":0.009073,"s":"BTCUSDT","T":1587812241184,"m":true},{"p":7564.04,"q":0.001481,"s":"BTCUSDT","T":1587812241082,"m":true},{"p":7564.04,"q":0.009302,"s":"BTCUSDT","T":1587812240974,"m":true},{"p":7564.04,"q":0.060158,"s":"BTCUSDT","T":1587812240877,"m":true},{"p":7564.04,"q":0.060152,"s":"BTCUSDT","T":1587812240468,"m":true},{"p":7564.05,"q":0.039637,"s":"BTCUSDT","T":1587812240357,"m":false},{"p":7564.05,"q":0.004076,"s":"BTCUSDT","T":1587812240345,"m":false},{"p":7564.04,"q":0.06005,"s":"BTCUSDT","T":1587812240092,"m":true},{"p":7564.04,"q":0.060102,"s":"BTCUSDT","T":1587812239706,"m":true},{"p":7564.04,"q":0.001734,"s":"BTCUSDT","T":1587812239512,"m":true},{"p":7564.04,"q":0.0608,"s":"BTCUSDT","T":1587812239321,"m":true},{"p":7564.04,"q":0.060127,"s":"BTCUSDT","T":1587812238932,"m":true},{"p":7564.05,"q":0.016244,"s":"BTCUSDT","T":1587812238659,"m":false},{"p":7564.04,"q":0.06008,"s":"BTCUSDT","T":1587812238548,"m":true},{"p":7564.04,"q":2.337533,"s":"BTCUSDT","T":1587812238487,"m":true},{"p":7564.04,"q":0.060057,"s":"BTCUSDT","T":1587812238158,"m":true},{"p":7564.05,"q":0.002643,"s":"BTCUSDT","T":1587812237797,"m":false},{"p":7564.04,"q":0.060138,"s":"BTCUSDT","T":1587812237772,"m":true},{"p":7564.04,"q":0.320702,"s":"BTCUSDT","T":1587812237485,"m":true},{"p":7564.04,"q":0.00171,"s":"BTCUSDT","T":1587812237399,"m":true},{"p":7564.04,"q":0.06057,"s":"BTCUSDT","T":1587812237397,"m":true},{"p":7564.04,"q":0.009073,"s":"BTCUSDT","T":1587812237091,"m":true},{"p":7564.04,"q":0.017502,"s":"BTCUSDT","T":1587812237017,"m":true},{"p":7564.05,"q":0.009073,"s":"BTCUSDT","T":1587812236998,"m":true},{"p":7564.05,"q":0.009073,"s":"BTCUSDT","T":1587812236888,"m":true},{"p":7564.12,"q":0.060166,"s":"BTCUSDT","T":1587812236627,"m":true},{"p":7564.28,"q":0.233656,"s":"BTCUSDT","T":1587812236262,"m":false},{"p":7564.12,"q":0.060282,"s":"BTCUSDT","T":1587812236245,"m":true},{"p":7564.09,"q":0.005965,"s":"BTCUSDT","T":1587812236156,"m":true},{"p":7564.16,"q":0.17819,"s":"BTCUSDT","T":1587812236054,"m":false},{"p":7564.19,"q":0.17819,"s":"BTCUSDT","T":1587812235950,"m":false},{"p":7564.05,"q":0.060059,"s":"BTCUSDT","T":1587812235857,"m":true},{"p":7564.23,"q":0.17819,"s":"BTCUSDT","T":1587812235848,"m":false},{"p":7564.06,"q":0.023916,"s":"BTCUSDT","T":1587812235533,"m":false},{"p":7564.05,"q":0.060079,"s":"BTCUSDT","T":1587812235469,"m":true},{"p":7564.05,"q":0.00171,"s":"BTCUSDT","T":1587812235447,"m":true},{"p":7564.06,"q":0.033063,"s":"BTCUSDT","T":1587812235440,"m":false},{"p":7564.06,"q":0.0088,"s":"BTCUSDT","T":1587812235320,"m":false},{"p":7564.06,"q":0.052828,"s":"BTCUSDT","T":1587812235289,"m":false},{"p":7563.91,"q":1.259241,"s":"BTCUSDT","T":1587812235090,"m":true},{"p":7564.14,"q":0.060165,"s":"BTCUSDT","T":1587812235063,"m":true},{"p":7564.29,"q":0.008832,"s":"BTCUSDT","T":1587812234696,"m":false},{"p":7564.06,"q":0.060098,"s":"BTCUSDT","T":1587812234674,"m":true},{"p":7564.29,"q":0.006165,"s":"BTCUSDT","T":1587812234574,"m":false},{"p":7564.58,"q":0.526562,"s":"BTCUSDT","T":1587812234383,"m":false},{"p":7563.89,"q":0.06012,"s":"BTCUSDT","T":1587812234285,"m":true},{"p":7564.48,"q":0.008858,"s":"BTCUSDT","T":1587812234276,"m":false},{"p":7564.37,"q":0.007442,"s":"BTCUSDT","T":1587812234068,"m":false},{"p":7564.66,"q":0.49713,"s":"BTCUSDT","T":1587812233967,"m":false},{"p":7563.85,"q":0.013802,"s":"BTCUSDT","T":1587812233949,"m":true}];

        const graphBiz = new GraphBiz();
        const result = await graphBiz.calculateDataTime(data, new Date( Date.now() - 1000 * 60 ), new Date());
        //to check if return is a array or no
        let containArrays = true;
        if(!Array.isArray(result)) {
            containArrays = false
        }

        expect(containArrays).toBeTruthy();
    });
});
